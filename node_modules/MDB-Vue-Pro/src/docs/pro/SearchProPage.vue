<template>
  <container>
    <h3 class="my-5">Search with buttons</h3>
    <form-inline class="mr-auto mb-4">
      <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn gradient="aqua" rounded size="sm" type="submit" class="mr-auto">Search</btn>
      <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn outline color="warning" rounded size="sm" type="submit" class="mr-auto">Search</btn>
      <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn color="unique" rounded size="sm" type="submit" class="mr-auto">Search</btn>
    </form-inline>
    <form class="form-inline mr-auto">
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn gradient="aqua" rounded size="sm" type="submit" class="mr-auto">Search</btn>
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn outline color="warning" rounded size="sm" type="submit" class="mr-auto">Search</btn>
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
      <btn color="unique" rounded size="sm" type="submit" class="mr-auto">Search</btn>
    </form>
    <h3 class="my-5">Search within navbar</h3>
    <navbar dark class="indigo" name="Navbar" href="#/" brandStyle="font-weight: bolder;">
      <navbar-collapse>
        <navbar-nav right>
          <form-inline class="ml-auto">
            <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
            <btn size="sm" type="submit" class="mr-auto" outline="white">Search</btn>
          </form-inline>
        </navbar-nav>
      </navbar-collapse>
    </navbar>
    <br/>
    <navbar class="blue-grey lighten-5" name="Navbar" href="#/" brandStyle="font-weight: bolder;">
      <navbar-collapse>
        <navbar-nav>
          <navbar-item active>Home</navbar-item>
          <navbar-item>Features</navbar-item>
          <navbar-item>Pricing</navbar-item>
          <!-- Dropdown -->
          <dropdown tag="li" class="nav-item">
            <dropdown-toggle @click.native="toggleDropdown(0)" tag="a" navLink color="blue-gray" waves-fixed>Dropdown</dropdown-toggle>
            <dropdown-menu v-show="active[0]">
              <dropdown-item>Action</dropdown-item>
              <dropdown-item>Another action</dropdown-item>
              <dropdown-item>Something else here</dropdown-item>
            </dropdown-menu>
          </dropdown>
        </navbar-nav>
        <navbar-nav right>
          <form-inline class="ml-auto">
            <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
          </form-inline>
        </navbar-nav>
      </navbar-collapse>
    </navbar>
    <br/>
    <navbar dark class="teal lighten-2" name="Navbar" href="#/" brandStyle="font-weight: bolder;">
      <navbar-collapse>
        <navbar-nav right>
          <form-inline class="ml-auto">
            <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search" />
          </form-inline>
        </navbar-nav>
      </navbar-collapse>
    </navbar>
    <br/>
    <navbar dark class="pink lighten-3" href="#/">
      <navbar-collapse>
        <navbar-nav>
          <form-inline class="ml-auto">
            <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search"/>
            <fa icon="search" class="white-text"/>
          </form-inline>
        </navbar-nav>
      </navbar-collapse>
      <a class="navbar-brand" href="#">Navbar</a>
    </navbar>
    <br/>
    <navbar dark class="blue lighten-3" href="#/">
      <navbar-collapse>
        <navbar-nav>
          <form-inline class="ml-auto">
            <md-input class="mr-sm-2" type="text" placeholder="Search" aria-label="Search"/>
            <btn color="mdb-color" rounded size="sm" class="mr-auto">Search</btn>
          </form-inline>
        </navbar-nav>
      </navbar-collapse>
      <a class="navbar-brand" href="#">Navbar</a>
    </navbar>
    <h3 class="my-5">Search within select</h3>
    <select-wrapper>
      <select-input @click.native="openSelect(1)" :text="text[1]"></select-input>
      <transition @before-enter="beforeEnter" @enter="enter" @after-enter="afterEnter" @before-leave="beforeLeave">
        <select-options search v-show="active[1]" class="collapse-item">
          <select-option disabled>Choose your option</select-option>
          <select-option @click.native="chooseOption" value="Option 1">Option nr 1</select-option>
          <select-option @click.native="chooseOption" value="Option 2">Option nr 2</select-option>
          <select-option @click.native="chooseOption" value="Option 3">Option nr 3</select-option>
          <select-option @click.native="chooseOption" value="Option 4">Option nr 4</select-option>
          <select-option @click.native="chooseOption" value="Option 5">Option nr 5</select-option>
        </select-options>
      </transition>
    </select-wrapper>
    <label>Example label</label>
    <h3 class="my-5">Search within multiselect</h3>
    <select-wrapper multiple>
      <select-input @click.native="openSelect(2)" :text="text[2]"></select-input>
      <transition @before-enter="beforeEnter" @enter="enter" @after-enter="afterEnter" @before-leave="beforeLeave">
        <select-options search v-show="active[2]" class="collapse-item">
          <select-option disabled>Choose your options</select-option>
          <select-option @click.native="chooseOption" multiple value="Option 1">Option nr 1</select-option>
          <select-option @click.native="chooseOption" multiple value="Option 2">Option nr 2</select-option>
          <select-option @click.native="chooseOption" multiple value="Option 3">Option nr 3</select-option>
          <select-option @click.native="chooseOption" multiple value="Option 4">Option nr 4</select-option>
          <select-option @click.native="chooseOption" multiple value="Option 5">Option nr 5</select-option>
          <btn save color="primary" size="sm">Save</btn>
        </select-options>
      </transition>
    </select-wrapper>
    <label>Example label</label>
    <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
  </container>
</template>

<script>
import { Container, MdInput, FormInline, Btn, Navbar, NavbarCollapse, NavbarNav, NavbarItem, Dropdown, DropdownItem, DropdownMenu, DropdownToggle, Fa, SelectWrapper, SelectInput, SelectOptions, SelectOption } from 'mdbvue';

export default {
  name: 'MasksPage',
  components: {
    Container,
    MdInput,
    FormInline,
    Btn,
    Navbar,
    NavbarCollapse,
    NavbarNav,
    NavbarItem,
    Dropdown,
    DropdownItem,
    DropdownMenu,
    DropdownToggle,
    Fa,
    SelectWrapper,
    SelectInput,
    SelectOptions,
    SelectOption
  },
  data() {
    return {
      active: {
        0: false,
        1: false,
        2: false
      },
      value: {
        0: false,
        1: false,
        2: false
      },
      text: {
        1: "Choose your option",
        2: "Choose your options"
      },
      activeSelect: false,
      elHeight: false,
      multiValues: [],
      multiTexts: []
    };
  },
  methods: {
    openSelect(index) {
      for (let i = 0; i < Object.keys(this.active).length; i++) {
        if (index !== i) {
          this.active[i] = false;
        }
      }
      this.active[index] = true;
      this.activeSelect = index;
    },
    chooseOption(e) {
      // check if select is multiple
      if (e.target.dataset.multiple === 'true') {
        if (this.multiValues.includes(e.target.getAttribute('data-value'))) {
          let valueIndex = this.multiValues.indexOf(e.target.getAttribute('data-value'));
          this.multiValues.splice(valueIndex, 1);
          this.multiTexts.splice(valueIndex, 1);
          e.target.parentNode.classList.remove('active');
          e.target.parentNode.getElementsByTagName('input')[0].removeAttribute('checked');
          if (!this.multiValues.length) {
            this.multiValues = [];
            this.multiTexts = "Choose Your options";
          }
        } else {
          if (this.multiTexts === "Choose Your options") {
            this.multiValues = [];
            this.multiTexts = [];
          }
          this.multiValues.push(e.target.getAttribute('data-value'));
          this.multiTexts.push(e.target.parentNode.getElementsByClassName('filtrable')[0].textContent);
          e.target.parentNode.classList.add('active');
          e.target.parentNode.getElementsByTagName('input')[0].setAttribute('checked', true);
        }
        this.value[this.activeSelect] = this.multiValues;
        this.text[this.activeSelect] = this.multiTexts;
      // if not multiple
      } else {
        let activeOption = e.target.parentNode.parentNode.getElementsByClassName('active')[0];
        if (activeOption) {
          activeOption.classList.remove('active');
        }
        e.target.parentNode.classList.add('active');
        this.value[this.activeSelect] = e.target.getAttribute('data-value');
        this.text[this.activeSelect] = e.target.parentNode.getElementsByClassName('filtrable')[0].textContent;
      }
    },
    beforeEnter(el) {
      el.style.display = 'block';
      this.elHeight = el.scrollHeight;
    },
    enter(el) {
      el.style.display = 'block';
      el.style.opacity = 1;
      el.style.height = this.elHeight + 'px';
    },
    afterEnter(el) {
      el.style.overflowY = 'auto';
    },
    beforeLeave(el) {
      el.style.overflowY = 'hidden';
      el.style.opacity = 0;
      el.style.height = 0;
      this.remove = setTimeout(() => {
        el.style.display = 'none';
      }, 500);
    },
    toggleDropdown(index) {
      for (let i = 0; i < Object.keys(this.active).length; i++) {
        if (index !== i) {
          this.active[i] = false;
        }
      }
      this.active[index] = !this.active[index];
    },
    allDropdownsClose(target) {
      // check if target is multiple select
      if (target) {
        if (target.dataset.multiple === 'true') {
          return;
        }
      }
      for (let i = 0; i < Object.keys(this.active).length; i++) {
        this.active[i] = false;
      }
    },
    onClick(e) {
      let parent = e.target;
      let body = document.getElementsByTagName('body')[0];
      while (parent !== body) {
        if (parent.classList.contains('search') || parent.classList.contains('dropdown') || parent.classList.contains('btn-group')) {
          return;
        }
        parent = parent.parentNode;
      }
      if (!e.target.classList.contains('select-dropdown')) {
        this.allDropdownsClose(e.target);
      }
    }
  },
  mounted() {
    document.addEventListener('click', this.onClick);
  },
  destroyed() {
    document.removeEventListener('click', this.onClick);
  }
};
</script>

<style scoped>
.collapse-item {
  overflow: hidden;
  opacity: 0;
  height: 0;
  transition: .5s;
}
</style>
